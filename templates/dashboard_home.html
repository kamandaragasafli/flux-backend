{% extends "dashboard_base.html" %}

{% block content %}
<div class="dashboard-content">
    <div class="performance-header">
        <div class="performance-title">Tracking Overview</div>
        <div class="performance-main-title">Performance</div>
        <div class="tab-buttons">
            <button class="tab-btn active">Today</button>
            <button class="tab-btn">Week</button>
            <button class="tab-btn">Month</button>
        </div>
    </div>

    <div class="main-chart-container">
        <canvas id="mainChart" class="main-chart"></canvas>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon blue">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-value">{{ total_users }}</div>
            <div class="stat-chart">
                <canvas id="usersChart"></canvas>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon purple">
                    <i class="fas fa-route"></i>
                </div>
                <div class="stat-label">Active Routes</div>
            </div>
            <div class="stat-value">{{ active_routes }}</div>
            <div class="stat-chart">
                <canvas id="routesChart"></canvas>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon green">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="stat-label">Total Locations</div>
            </div>
            <div class="stat-value">{{ total_locations }}</div>
            <div class="stat-chart">
                <canvas id="locationsChart"></canvas>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon orange">
                    <i class="fas fa-user-doctor"></i>
                </div>
                <div class="stat-label">Visited Doctors</div>
            </div>
            <div class="stat-value">{{ total_visited_doctors|default:0 }}</div>
            <div class="stat-subtext">
                Last 24h: {{ hospital_visits_last_24h|default:0 }} hospital visits
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon teal">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-label">Visit Schedules</div>
            </div>
            <div class="stat-value">{{ total_schedules|default:0 }}</div>
            <div class="stat-subtext">
                Active weekly plans
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon red">
                    <i class="fas fa-location-slash"></i>
                </div>
                <div class="stat-label">Location Reports</div>
            </div>
            <div class="stat-value">{{ total_location_reports|default:0 }}</div>
            <div class="stat-subtext">
                Last 24h: {{ location_reports_last_24h|default:0 }}
            </div>
        </div>
    </div>

    <div class="bottom-section">
        <div class="section-card">
            <div class="section-header">
                <div>
                    <div class="section-title">Active Users</div>
                    <div style="color: rgba(255,255,255,0.5); font-size: 13px; margin-top: 5px;">Currently Tracking</div>
                </div>
            </div>
            {% if active_routes_list %}
            <div class="task-list">
                {% for route in active_routes_list|slice:":5" %}
                <div class="task-item">
                    <div class="task-checkbox {% if route.is_paused %}task-checkbox-paused{% else %}task-checkbox-active{% endif %}">
                        <i class="fas fa-{% if route.is_paused %}pause{% else %}play{% endif %}" style="color: white; font-size: 10px;"></i>
                    </div>
                    <div class="task-content">
                        <div class="task-title">{{ route.user.username }}</div>
                        <div class="task-meta">{{ route.points.count }} points â€¢ Started {{ route.start_time|date:"d.m.Y H:i" }}</div>
                    </div>
                    <div class="task-menu">
                        <i class="fas fa-ellipsis-v"></i>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-users"></i>
                <p>No active users</p>
            </div>
            {% endif %}
        </div>

        <div class="section-card">
            <div class="section-header">
                <div class="section-title">Recent Activity</div>
            </div>
            <table class="simple-table">
                <thead>
                    <tr>
                        <th>USER</th>
                        <th>EVENT</th>
                        <th>DETAIL</th>
                        <th>TIME</th>
                    </tr>
                </thead>
                <tbody>
                    {% for route in active_routes_list|slice:":5" %}
                    <tr>
                        <td>{{ route.user.username }}</td>
                        <td>Route Started</td>
                        <td>{{ route.points.count }} points</td>
                        <td>{{ route.start_time|date:"d.m.Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                    {% for report in recent_location_reports|slice:":5" %}
                    <tr>
                        <td>{{ report.user.username }}</td>
                        <td>Location Stopped</td>
                        <td>{{ report.get_reason_display }}</td>
                        <td>{{ report.timestamp|date:"d.m.Y H:i:s" }}</td>
                    </tr>
                    {% empty %}
                    {% if not active_routes_list %}
                    <tr>
                        <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.5);">No recent activity</td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}


